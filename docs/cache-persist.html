<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Cache Persist · Morrys Repositories</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="**wora/cache-persist** allows you, with very little effort of work, to manage the state within your application and its persistence in storage."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Cache Persist · Morrys Repositories"/><meta property="og:type" content="website"/><meta property="og:url" content="https://morrys.github.io/wora/"/><meta property="og:description" content="**wora/cache-persist** allows you, with very little effort of work, to manage the state within your application and its persistence in storage."/><meta property="og:image" content="https://morrys.github.io/wora/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://morrys.github.io/wora/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/wora/img/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-146953551-1', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/wora/js/scrollSpy.js"></script><link rel="stylesheet" href="/wora/css/main.css"/><script src="/wora/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/wora/"><img class="logo" src="/wora/img/favicon.ico" alt="Morrys Repositories"/><h2 class="headerTitleWithLogo">Morrys Repositories</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/wora/docs/introduction" target="_self">Docs</a></li><li class=""><a href="https://github.com/morrys/wora" target="_self">GitHub</a></li><li class=""><a target="_self"></a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>caching</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">wora</h3><ul class=""><li class="navListItem"><a class="navItem" href="/wora/docs/introduction">wora</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">caching</h3><ul class=""><li class="navListItem navListItemActive"><a class="navItem" href="/wora/docs/cache-persist">Cache Persist</a></li><li class="navListItem"><a class="navItem" href="/wora/docs/relay-store">Relay Store</a></li><li class="navListItem"><a class="navItem" href="/wora/docs/apollo-cache">Apollo Cache</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">networking</h3><ul class=""><li class="navListItem"><a class="navItem" href="/wora/docs/netinfo">NetInfo</a></li><li class="navListItem"><a class="navItem" href="/wora/docs/detect-network">Detect Network</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">offline</h3><ul class=""><li class="navListItem"><a class="navItem" href="/wora/docs/architecture">Offline Architecture</a></li><li class="navListItem"><a class="navItem" href="/wora/docs/thinking-offline">Thinking Offline</a></li><li class="navListItem"><a class="navItem" href="/wora/docs/offline-first">Offline First</a></li><li class="navListItem"><a class="navItem" href="/wora/docs/relay-offline">Relay Offline</a></li><li class="navListItem"><a class="navItem" href="/wora/docs/apollo-offline">Apollo Offline</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Cache Persist</h1></header><article><div><span><p><strong>wora/cache-persist</strong> allows you, with very little effort of work, to manage the state within your application and its persistence in storage.</p>
<p>All you need to know to use it is the <strong>Cache class</strong> and the <strong>configurations</strong> it makes available to you.</p>
<p>Let’s start right now by viewing the wora/cache-persist Cache:</p>
<pre><code class="hljs css language-ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> ICache {
    <span class="hljs-comment">// functions to read</span>
    <span class="hljs-keyword">get</span>(key: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">any</span>;
    getState(): Readonly&lt;DataCache&gt;;
    getAllKeys(): <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;;
    has(key: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">boolean</span>;
    <span class="hljs-comment">// functions to write</span>
    <span class="hljs-keyword">set</span>(key: <span class="hljs-built_in">string</span>, value: <span class="hljs-built_in">any</span>): <span class="hljs-built_in">void</span>;
    <span class="hljs-keyword">delete</span>(key: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span>;
    remove(key: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span>;
    purge(): <span class="hljs-built_in">void</span>;
    replace(data: <span class="hljs-built_in">any</span>): <span class="hljs-built_in">void</span>;
    <span class="hljs-comment">// functions to manage persistence</span>
    isRehydrated(): <span class="hljs-built_in">boolean</span>;
    restore(): <span class="hljs-built_in">Promise</span>&lt;DataCache&gt;;
    flush(): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> DataCache = {
    [key: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">any</span>;
};
</code></pre>
<p>As you can see from the interface above, there are 3 categories of functions:</p>
<ul>
<li><strong>to read:</strong> these functions, synchronous, allow you to read state data</li>
<li><strong>to write:</strong> these functions, synchronous, allow you to write data in the state</li>
<li><strong>to manage persistence:</strong> these functions allow you to manage the persistence of state within the storage</li>
</ul>
<p><strong>The read and write functions are very similar to those of the Map object, so I do not need to add anything</strong> else while the <strong>restore, isRehydrated and flush functions are described below</strong> so that you better understand when and how to use them.</p>
<ul>
<li><strong>restore: it is the most important function of all</strong>, in fact it must necessarily be used in order to connect the store to its reference storage and initialize the cache state. Apart from special situations, e.g. Server Side Rendering, this function is recommended to be called when starting the application.</li>
<li><strong>flush:</strong> this function allows you to make sure that the storage is synchronized with state data.</li>
<li><strong>isRehydrated:</strong> this function lets you know if the cache has been connected with the storage via the restore function</li>
</ul>
<p>Well, now we can see how to use the cache within our application.</p>
<h3><a class="anchor" aria-hidden="true" id="first-lets-install-the-packages-we-need"></a><a href="#first-lets-install-the-packages-we-need" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>First, let’s install the packages we need:</h3>
<ul>
<li>wora/cache-persist using yarn or npm:</li>
</ul>
<pre><code class="hljs"><span class="hljs-selector-tag">yarn</span> <span class="hljs-selector-tag">add</span> @<span class="hljs-keyword">wora</span>/<span class="hljs-keyword">cache</span>-<span class="hljs-keyword">persist</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="now-i-can-show-you-the-simplest-use-case"></a><a href="#now-i-can-show-you-the-simplest-use-case" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Now, I can show you the simplest use case:</h3>
<pre><code class="hljs css language-ts"><span class="hljs-keyword">import</span> { Cache } <span class="hljs-keyword">from</span> <span class="hljs-string">"@wora/cache-persist"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">new</span> Cache();

<span class="hljs-comment">// ...</span>
<span class="hljs-keyword">await</span> cache.restore();
<span class="hljs-comment">// ...</span>

cache.set(<span class="hljs-string">'name'</span>, <span class="hljs-string">'lorenzo'</span>);
<span class="hljs-keyword">const</span> name = cache.get(<span class="hljs-string">'name'</span>);
</code></pre>
<p>That’s all :)</p>
<p>Obviously only in very rare cases are we lucky enough to have to manage such a simple case where we use the localStorage (or for ReactNative the AsyncStorage) without one of these problems:</p>
<ul>
<li>How can I initialize the cache with data?</li>
<li>There is data in the storage that is not compatible with the new version of the application, how can I migrate it?</li>
<li>How can I use the same storage to manage different states? (e.g. different state based on the logged in user)</li>
<li>How can I use indexedDB?</li>
<li>How can I use session storage?</li>
<li>How can I prevent some state data from being saved within the storage?</li>
<li>How can I encrypt the data before it is saved in the storage?</li>
<li>How do I handle storage errors when saving data?</li>
</ul>
<p>The library gives an answer to these problems (and not only these) through its configurations.</p>
<p>For this reason I will start by describing all its configurations and then I will show you how to use them to answer the problems indicated above</p>
<h2><a class="anchor" aria-hidden="true" id="cache-options"></a><a href="#cache-options" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cache Options:</h2>
<p><code>prefix:</code> [Optional][Default: cache] when this option is defined, the prefixLayer mutation included in the library is used in order to add / remove the prefix to persisted keys.</p>
<p><code>serialize:</code> [Optional][Default: true] when this option is true, the jsonSerialize mutation included in the library is used in order to handles JSON serialization and deserialization of values</p>
<p><code>mutateKeys:</code> [Optional] with this option you can configure an array of mutation functions that will be executed in order to change the keys while writing / reading in the storage. The prefix option will insert the prefixLayer function as the first in the list.</p>
<p><code>mutateValues:</code> [Optional] with this option you can configure an array of mutation functions that will be executed in order to change the values while writing / reading in the storage. The serialize option will insert the jsonSerialize function as the last in the list.</p>
<p><code>webStorage:</code> [Optional][Default: local] with this option it is possible to decide to use the sessionStorage by enhancing the property with session</p>
<p><code>storage:</code> [Optional][Default: localStorage/AsyncStorage] when you need to use custom storage or the indexedb, this property must be set.</p>
<p><code>throttle:</code> [Optional][Default: 500] Defines the expiration interval of the debounce</p>
<p><code>errorHandling:</code> [Optional] Allows you to define the callback function that is executed in case errors are raised during the write process to the storage.</p>
<p><code>disablePersist:</code> [Optional][Default: false] Allows you to use the cache as an inmemory cache.</p>
<pre><code class="hljs css language-ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> CacheOptions = {
    initialState?: DataCache;
    serialize?: <span class="hljs-built_in">boolean</span>;
    prefix?: <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span> | <span class="hljs-literal">null</span>;
    mergeState?: <span class="hljs-function">(<span class="hljs-params">restoredState?: DataCache, initialState?: DataCache</span>) =&gt;</span> <span class="hljs-built_in">Promise</span>&lt;DataCache&gt; | DataCache;
    mutateKeys?: <span class="hljs-built_in">Array</span>&lt;IMutateKey&gt;;
    mutateValues?: <span class="hljs-built_in">Array</span>&lt;IMutateValue&gt;;
    storage?: ICacheStorage;
    webStorage?: <span class="hljs-string">'local'</span> | <span class="hljs-string">'session'</span>;
    disablePersist?: <span class="hljs-built_in">boolean</span>;
    errorHandling?: <span class="hljs-function">(<span class="hljs-params">cache: ICache, error: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">boolean</span>;
    throttle?: <span class="hljs-built_in">number</span>;
};
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="how-can-i-initialize-the-cache-with-data"></a><a href="#how-can-i-initialize-the-cache-with-data" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How can I initialize the cache with data?</h3>
<pre><code class="hljs css language-ts"><span class="hljs-keyword">import</span> { Cache } <span class="hljs-keyword">from</span> <span class="hljs-string">"@wora/cache-persist"</span>;
<span class="hljs-keyword">const</span> initialState = {
  name: <span class="hljs-string">"lorenzo"</span>,
}

<span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">new</span> Cache({
  initialState,
});
<span class="hljs-comment">// ...</span>
<span class="hljs-keyword">await</span> cache.restore();
<span class="hljs-comment">// ...</span>
<span class="hljs-keyword">const</span> name = cache.get(<span class="hljs-string">'name'</span>);
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="there-is-data-in-the-storage-that-is-not-compatible-with-the-new-version-of-the-application-how-can-i-migrate-it"></a><a href="#there-is-data-in-the-storage-that-is-not-compatible-with-the-new-version-of-the-application-how-can-i-migrate-it" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>There is data in the storage that is not compatible with the new version of the application, how can I migrate it?</h3>
<pre><code class="hljs css language-ts"><span class="hljs-keyword">import</span> { Cache } <span class="hljs-keyword">from</span> <span class="hljs-string">"@wora/cache-persist"</span>;
<span class="hljs-keyword">const</span> initialState = {
  name: <span class="hljs-string">"lorenzo"</span>,
};

<span class="hljs-keyword">const</span>  mergeState = <span class="hljs-function">(<span class="hljs-params">restoredState, initialState</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> migrationState = <span class="hljs-comment">// your logic </span>
  <span class="hljs-keyword">return</span> migrationState;
};

<span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">new</span> Cache({
  initialState,
  mergeState
});
<span class="hljs-comment">// ...</span>
<span class="hljs-keyword">await</span> cache.restore();
<span class="hljs-comment">// ...</span>
<span class="hljs-keyword">const</span> name = cache.get(<span class="hljs-string">'name'</span>);
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="how-can-i-use-the-same-storage-to-manage-different-states-eg-different-state-based-on-the-logged-in-user"></a><a href="#how-can-i-use-the-same-storage-to-manage-different-states-eg-different-state-based-on-the-logged-in-user" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How can I use the same storage to manage different states? (e.g. different state based on the logged in user)</h3>
<pre><code class="hljs css language-ts"><span class="hljs-keyword">import</span> { Cache } <span class="hljs-keyword">from</span> <span class="hljs-string">"@wora/cache-persist"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> cacheApp = <span class="hljs-keyword">new</span> Cache({
   prefix: <span class="hljs-string">'app'</span>
});

<span class="hljs-keyword">export</span> getUserCache = <span class="hljs-keyword">async</span> (user: <span class="hljs-built_in">string</span>) =&gt; {
  <span class="hljs-keyword">const</span> cacheUser = <span class="hljs-keyword">new</span> Cache({
     prefix: user
  });
  <span class="hljs-keyword">await</span> cacheUser.restore();
  <span class="hljs-keyword">return</span> cacheUser;
}

<span class="hljs-comment">// ...</span>
<span class="hljs-keyword">await</span> cacheApp.restore();
<span class="hljs-comment">// ...</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="how-can-i-use-indexeddb"></a><a href="#how-can-i-use-indexeddb" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How can I use indexedDB?</h3>
<pre><code class="hljs css language-ts"><span class="hljs-keyword">import</span> {Cache, CacheStorage, CacheOptions } <span class="hljs-keyword">from</span> <span class="hljs-string">"@wora/cache-persist"</span>;
<span class="hljs-keyword">import</span> { IDBStorage } <span class="hljs-keyword">from</span> <span class="hljs-string">'@wora/cache-persist/lib/idbstorage'</span>;

<span class="hljs-keyword">const</span> idbStorages: CacheStorage[] = IDBStorage.create( {
    name: <span class="hljs-string">"cache"</span>, 
    storeNames: [<span class="hljs-string">"persist"</span>]
});

<span class="hljs-keyword">const</span> idb: CacheOptions = {
    storage: idbStorages[<span class="hljs-number">0</span>],
    serialize: <span class="hljs-literal">false</span>,
}

<span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">new</span> Cache(idb);

<span class="hljs-comment">// ...</span>
<span class="hljs-keyword">await</span> cache.restore();
cache.set(<span class="hljs-string">'name'</span>, <span class="hljs-string">'lorenzo'</span>);
<span class="hljs-keyword">const</span> name = cache.get(<span class="hljs-string">'name'</span>)
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="how-can-i-use-session-storage"></a><a href="#how-can-i-use-session-storage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How can I use session storage?</h3>
<pre><code class="hljs css language-ts"><span class="hljs-keyword">import</span> { Cache } <span class="hljs-keyword">from</span> <span class="hljs-string">"@wora/cache-persist"</span>;

<span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">new</span> Cache({
  webStorage: <span class="hljs-string">'session'</span>,
});
<span class="hljs-comment">// ...</span>
<span class="hljs-keyword">await</span> cache.restore();
<span class="hljs-comment">// ...</span>
<span class="hljs-keyword">const</span> name = cache.get(<span class="hljs-string">'name'</span>);
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="how-can-i-prevent-some-state-data-from-being-saved-within-the-storage"></a><a href="#how-can-i-prevent-some-state-data-from-being-saved-within-the-storage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How can I prevent some state data from being saved within the storage?</h3>
<pre><code class="hljs css language-ts"><span class="hljs-keyword">import</span> { filterKeys } <span class="hljs-keyword">from</span> <span class="hljs-string">'@wora/cache-persist/lib/layers/filterKeys'</span>;
<span class="hljs-keyword">import</span> { IMutateKey } <span class="hljs-keyword">from</span> <span class="hljs-string">'@wora/cache-persist'</span>;

<span class="hljs-keyword">const</span> filterNoPersist: IMutateKey = filterKeys(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> !key.includes(<span class="hljs-string">"exclude"</span>));

<span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">new</span> Cache({
    mutateKeys: [filterNoPersist],
});
<span class="hljs-comment">// ...</span>

<span class="hljs-keyword">await</span> cache.restore();

cache.set(<span class="hljs-string">'include'</span>, <span class="hljs-string">'persist'</span>);
cache.set(<span class="hljs-string">'exclude'</span>, <span class="hljs-string">'do not persist'</span>);
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="how-can-i-encrypt-the-data-before-it-is-saved-in-the-storage"></a><a href="#how-can-i-encrypt-the-data-before-it-is-saved-in-the-storage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How can I encrypt the data before it is saved in the storage?</h3>
<pre><code class="hljs css language-ts"><span class="hljs-keyword">import</span> { Cache, IMutateValue, mutateValuesLayer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@wora/cache-persist'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> encrypt: IMutateValue = mutateValues(
    <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> crypt(value),
    <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> decrypt(value),
);

<span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">new</span> Cache({
    mutateValues: [encrypt],
});
<span class="hljs-comment">// ...</span>

<span class="hljs-keyword">await</span> cache.restore();

cache.set(<span class="hljs-string">'name'</span>, <span class="hljs-string">'lorenzo'</span>);
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="how-do-i-handle-storage-errors-when-saving-data"></a><a href="#how-do-i-handle-storage-errors-when-saving-data" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How do I handle storage errors when saving data?</h3>
<pre><code class="hljs css language-ts"><span class="hljs-keyword">import</span> { Cache } <span class="hljs-keyword">from</span> <span class="hljs-string">'@wora/cache-persist'</span>;

<span class="hljs-keyword">const</span> errorHandling = <span class="hljs-function">(<span class="hljs-params">cache: Cache, error: <span class="hljs-built_in">Error</span></span>) =&gt;</span> {
  <span class="hljs-comment">// your logic</span>
};

<span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">new</span> Cache({
    errorHandling,
});
<span class="hljs-comment">// ...</span>

<span class="hljs-keyword">await</span> cache.restore();

cache.set(<span class="hljs-string">'name'</span>, <span class="hljs-string">'lorenzo'</span>);
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="whats-next"></a><a href="#whats-next" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What’s next</h2>
<p>For those interested in knowing how it was implemented, I recommend reading:
<a href="https://medium.com/@morrys/state-persistence-in-javascript-wora-cache-persist-deep-into-its-source-code-56fb86147053">State persistence in JavaScript — wora/cache-persist — Deep into its Source Code</a></p>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 2021-1-19 by Lorenzo Di Giacomo</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/wora/docs/introduction"><span class="arrow-prev">← </span><span>wora</span></a><a class="docs-next button" href="/wora/docs/relay-store"><span>Relay Store</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#cache-options">Cache Options:</a><ul class="toc-headings"><li><a href="#how-can-i-initialize-the-cache-with-data">How can I initialize the cache with data?</a></li><li><a href="#there-is-data-in-the-storage-that-is-not-compatible-with-the-new-version-of-the-application-how-can-i-migrate-it">There is data in the storage that is not compatible with the new version of the application, how can I migrate it?</a></li><li><a href="#how-can-i-use-the-same-storage-to-manage-different-states-eg-different-state-based-on-the-logged-in-user">How can I use the same storage to manage different states? (e.g. different state based on the logged in user)</a></li><li><a href="#how-can-i-use-indexeddb">How can I use indexedDB?</a></li><li><a href="#how-can-i-use-session-storage">How can I use session storage?</a></li><li><a href="#how-can-i-prevent-some-state-data-from-being-saved-within-the-storage">How can I prevent some state data from being saved within the storage?</a></li><li><a href="#how-can-i-encrypt-the-data-before-it-is-saved-in-the-storage">How can I encrypt the data before it is saved in the storage?</a></li><li><a href="#how-do-i-handle-storage-errors-when-saving-data">How do I handle storage errors when saving data?</a></li></ul></li><li><a href="#whats-next">What’s next</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/wora/" class="nav-home"><img src="/wora/img/favicon.ico" alt="Morrys Repositories" width="66" height="58"/></a><div><h5>Docs</h5><a href="/wora/docs/en/introduction.html">about wora</a></div><div><h5>Community</h5><a href="/wora/en/users.html">User Showcase</a></div><div><h5>More</h5><a href="https://github.com/morrys/wora">GitHub</a><a class="github-button" href="https://github.com/morrys/wora" data-icon="octicon-star" data-count-href="https://github.com/morrys/wora/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a><div class="social"><a href="https://twitter.com/m0rrys" class="twitter-follow-button">Follow @m0rrys</a></div></div></section><a href="https://opensource.facebook.com/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/wora/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2021 Lorenzo Di Giacomo</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '87a72e28932891cac536490e275e834e',
                indexName: 'morrys',
                inputSelector: '#search_input_react'
              });
            </script></body></html>